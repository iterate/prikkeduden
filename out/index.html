<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Prikked√∏den</title>
    <style type="text/css">
      body {
        margin: 0;
        background-color: #dc5052;
      }
    </style>
    <script type="text/javascript" src="app.js"></script>
  </head>
  <body>
    <main></main>
    <canvas id="input"></canvas>
    <canvas id="output"></canvas>
    <script>
      var app = Elm.Main.init({ node: document.querySelector("main") });

      var imgUrl = "bob.jpg";

      var inputCanvas = document.getElementById("input");
      var outputCanvas = document.getElementById("output");
      var outctx = outputCanvas.getContext("2d");
      var ctx = inputCanvas.getContext("2d");

      var img = new Image();
      img.src = imgUrl;
      img.onload = () => {
        inputCanvas.height = img.height;
        inputCanvas.width = img.width;
        outputCanvas.height = img.height;
        outputCanvas.width = img.width;
        ctx.drawImage(img, 0, 0);
      };
      // img.style.display = "none";

      app.ports.getImageData.subscribe(function(data) {
        console.log("GET IMAGE, DATA!");
        var imageData = ctx.getImageData(
          0,
          0,
          inputCanvas.width,
          inputCanvas.height
        );
        var data = imageData.data;

        app.ports.setImageData.send(Array.from(data));
      });

      app.ports.putImageData.subscribe(function(data) {
        console.log("gotten", data);
        var u8a = new Uint8ClampedArray(data);
        var id = new ImageData(u8a, img.width, img.height);
        outctx.putImageData(id, 0, 0);
      });
    </script>
  </body>
</html>
